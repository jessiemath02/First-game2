<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jessie Math - 二位數加減法挑戰賽</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-yellow: #FFD700;
            --secondary-blue: #4A90E2;
            --accent-red: #FF4B2B;
            --correct-green: #4CAF50;
            --bg-color: #F8FDFF;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* Header 區域 */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .brand-container { display: flex; align-items: center; }
        .brand-logo {
            width: 45px; height: 45px;
            background-color: var(--primary-yellow);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            margin-right: 8px;
        }
        .brand-logo img { width: 85%; }
        .brand-text { font-size: 20px; font-weight: bold; color: #333; }

        .nav-buttons { display: flex; gap: 5px; }
        .nav-btn {
            text-decoration: none; color: #555; font-size: 12px;
            display: flex; flex-direction: column; align-items: center;
            background: #f8f8f8; padding: 6px 8px; border-radius: 8px;
        }

        /* 遊戲螢幕控制 */
        .screen {
            display: none; flex-direction: column; align-items: center;
            min-height: 85vh; padding: 20px; text-align: center;
        }
        .screen.active { display: flex; }

        /* 卡片設計 */
        .card {
            background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 90%; max-width: 400px;
        }
        input[type="text"] {
            width: 80%; padding: 12px; font-size: 18px;
            border: 2px solid var(--secondary-blue); border-radius: 10px; margin: 15px 0;
        }

        /* 關卡選擇與排行榜 */
        .level-container { width: 100%; max-width: 600px; }
        .level-grid {
            display: grid; grid-template-columns: 1fr; gap: 12px; margin-bottom: 25px;
        }
        .level-card {
            background: white; padding: 18px; border-radius: 15px;
            border: 3px solid var(--primary-yellow); cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }

        .leaderboard {
            background: #fff3cd; padding: 15px; border-radius: 15px; text-align: left;
        }
        .leader-item {
            display: flex; justify-content: space-between; 
            padding: 8px 0; border-bottom: 1px solid #eec;
        }

        /* 遊戲核心 */
        .math-vertical {
            font-family: 'Courier New', monospace; font-size: 65px;
            text-align: right; line-height: 1.1; margin: 20px auto;
            border-bottom: 6px solid #333; padding: 0 20px; display: inline-block;
        }
        
        .feedback-overlay {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 36px; font-weight: bold; z-index: 2000; pointer-events: none;
            display: none; padding: 25px; border-radius: 20px; color: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); text-align: center;
        }

        .options-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px;
        }
        .option-btn {
            background: white; border: 2px solid #ddd; padding: 20px;
            font-size: 28px; border-radius: 15px; cursor: pointer;
            box-shadow: 0 4px 0 #ccc;
        }
        .option-btn:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>

<header>
    <div class="brand-container">
        <div class="brand-logo"><img src="JESSIEMATH-Q.png" alt="Q"></div>
        <div class="brand-text">Jessie Math</div>
    </div>
    <div class="nav-buttons">
        <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-btn"><i class="fas fa-home"></i>首頁</a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-btn"><i class="fas fa-gamepad"></i>大廳</a>
        <a href="https://jessiemath0703-chu.github.io/Game-Lobby/#g2-u2" class="nav-btn"><i class="fas fa-undo"></i>二年級二位數的加減法</a>
    </div>
</header>

<div id="screen-login" class="screen active">
    <div class="card">
        <h2>輸入名字開始冒險</h2>
        <input type="text" id="player-name" placeholder="你的名字">
        <p style="text-align: left; font-size: 14px;">⏲️ 60秒挑戰 / ✅ 答對+5秒 / ❌ 答錯顯示答案</p>
        <button class="option-btn" style="background: var(--primary-yellow); width: 100%; border:none;" onclick="startGame()">開始</button>
    </div>
</div>

<div id="screen-levels" class="screen">
    <h2>請選擇冒險關卡</h2>
    <div class="level-container">
        <div class="level-grid">
            <div class="level-card" onclick="selectLevel(1)"><div>第一關：加法</div><i class="fas fa-plus-circle"></i></div>
            <div class="level-card" onclick="selectLevel(2)"><div>第二關：減法</div><i class="fas fa-minus-circle"></i></div>
            <div class="level-card" onclick="selectLevel(3)"><div>第三關：比較</div><i class="fas fa-exchange-alt"></i></div>
        </div>
        <div class="leaderboard">
            <h3><i class="fas fa-medal"></i> 排行榜</h3>
            <div id="board-content"></div>
        </div>
    </div>
</div>

<div id="screen-game" class="screen">
    <div style="display: flex; justify-content: space-between; width: 100%; font-weight: bold;">
        <div id="timer-display">⏳ 60s</div>
        <div id="combo-display" style="color: red;"></div>
        <div id="score-display">⭐ 0</div>
    </div>
    <button onclick="speakQuestion()" style="margin: 10px; padding: 5px 15px;"><i class="fas fa-volume-up"></i> 唸題目</button>
    <div id="math-box" style="flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 200px;"></div>
    <div class="options-grid" id="options-box"></div>
    <div style="margin-top: 20px; display: flex; gap: 10px;">
        <button onclick="pauseGame()" class="nav-btn">暫停</button>
        <button onclick="restartLevel()" class="nav-btn">重新</button>
        <button onclick="exitToMenu()" class="nav-btn">選單</button>
    </div>
</div>

<div id="feedback" class="feedback-overlay"></div>

<div id="screen-result" class="screen">
    <div class="card">
        <h2>挑戰結束</h2>
        <div id="star-box" style="font-size: 50px; color: gold;"></div>
        <p>得分：<strong id="res-score" style="font-size: 30px;">0</strong></p>
        <button class="option-btn" style="background: var(--secondary-blue); color:white; width: 100%; border:none;" onclick="exitToMenu()">返回</button>
    </div>
</div>

<script>
    let playerName = "";
    let score = 0, timeLeft = 60, combo = 0, timer, currentLv = 1, correctAns, isPaused = false;
    let rankings = { 1: {name: "無", score: 0}, 2: {name: "無", score: 0}, 3: {name: "無", score: 0} };

    function startGame() {
        playerName = document.getElementById('player-name').value;
        if (!playerName) return alert("請輸入名字");
        switchScreen('screen-levels');
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'screen-levels') {
            updateLeaderboardDisplay();
            // 已經移除此處的自動唸法
        }
    }

    function selectLevel(lv) {
        currentLv = lv; score = 0; timeLeft = 60; combo = 0;
        document.getElementById('score-display').innerText = "⭐ 0";
        switchScreen('screen-game');
        nextQuestion();
        startTimer();
    }

    function startTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
            if(!isPaused) {
                timeLeft--;
                document.getElementById('timer-display').innerText = `⏳ ${timeLeft}s`;
                if(timeLeft <= 0) endGame();
            }
        }, 1000);
    }

    function nextQuestion() {
        const mathBox = document.getElementById('math-box');
        const optsBox = document.getElementById('options-box');
        let n1 = Math.floor(Math.random() * 45) + 10;
        let n2 = Math.floor(Math.random() * 45) + 10;

        if (currentLv === 1) {
            correctAns = n1 + n2;
            mathBox.innerHTML = `<div class="math-vertical">${n1}<br>+ ${n2}</div>`;
            window.qText = `${n1}加${n2}`;
        } else if (currentLv === 2) {
            if(n1 < n2) [n1, n2] = [n2, n1];
            correctAns = n1 - n2;
            mathBox.innerHTML = `<div class="math-vertical">${n1}<br>- ${n2}</div>`;
            window.qText = `${n1}減${n2}`;
        } else {
            correctAns = n1 > n2 ? ">" : (n1 < n2 ? "<" : "=");
            mathBox.innerHTML = `<div style="font-size: 50px; font-weight:bold;">${n1} ? ${n2}</div>`;
            window.qText = `${n1}與${n2}的大小比較`;
        }

        optsBox.innerHTML = "";
        let choices = currentLv === 3 ? [">", "<", "="] : generateChoices(correctAns);
        choices.forEach(val => {
            let b = document.createElement('button');
            b.className = 'option-btn';
            b.innerText = val;
            b.onclick = () => check(val);
            optsBox.appendChild(b);
        });
    }

    function generateChoices(correct) {
        let s = new Set([correct]);
        while(s.size < 4) {
            let f = correct + (Math.floor(Math.random()*11) - 5);
            if(f >= 0 && f !== correct) s.add(f);
        }
        return Array.from(s).sort(() => Math.random() - 0.5);
    }

    function check(userAns) {
        const fd = document.getElementById('feedback');
        fd.style.display = 'block';
        if (userAns == correctAns) {
            score += 10 + (combo * 2); combo++; timeLeft += 5;
            fd.innerHTML = "✅ 答對了！"; fd.style.background = "var(--correct-green)";
        } else {
            combo = 0; timeLeft -= 5;
            fd.innerHTML = `❌ 不對唷！<br>正確答案是 ${correctAns}`;
            fd.style.background = "var(--accent-red)";
        }
        document.getElementById('score-display').innerText = `⭐ ${score}`;
        setTimeout(() => { fd.style.display = 'none'; nextQuestion(); }, 1200);
    }

    function updateLeaderboardDisplay() {
        let html = "";
        for(let i=1; i<=3; i++) {
            html += `<div class="leader-item"><span>關卡${i}：${rankings[i].name}</span><span>${rankings[i].score}分</span></div>`;
        }
        document.getElementById('board-content').innerHTML = html;
    }

    function endGame() {
        clearInterval(timer);
        switchScreen('screen-result');
        document.getElementById('res-score').innerText = score;
        document.getElementById('star-box').innerText = score >= 120 ? "⭐⭐⭐" : (score >= 60 ? "⭐⭐" : "⭐");
        if(score > rankings[currentLv].score) rankings[currentLv] = { name: playerName, score: score };
    }

    function pauseGame() { isPaused = true; alert("遊戲暫停"); isPaused = false; }
    function restartLevel() { selectLevel(currentLv); }
    function exitToMenu() { clearInterval(timer); switchScreen('screen-levels'); }

    function speak(txt) {
        window.speechSynthesis.cancel();
        let u = new SpeechSynthesisUtterance(txt);
        u.lang = 'zh-TW';
        window.speechSynthesis.speak(u);
    }

    function speakQuestion() { speak(window.qText); }
</script>
</body>
</html>